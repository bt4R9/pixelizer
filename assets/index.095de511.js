var b=Object.defineProperty;var _=(g,e,i)=>e in g?b(g,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):g[e]=i;var r=(g,e,i)=>(_(g,typeof e!="symbol"?e+"":e,i),i);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))f(a);new MutationObserver(a=>{for(const p of a)if(p.type==="childList")for(const m of p.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&f(m)}).observe(document,{childList:!0,subtree:!0});function i(a){const p={};return a.integrity&&(p.integrity=a.integrity),a.referrerpolicy&&(p.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?p.credentials="include":a.crossorigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function f(a){if(a.ep)return;a.ep=!0;const p=i(a);fetch(a.href,p)}})();var x={exports:{}};(function(g){var e=Object.prototype.hasOwnProperty,i="~";function f(){}Object.create&&(f.prototype=Object.create(null),new f().__proto__||(i=!1));function a(l,n,s){this.fn=l,this.context=n,this.once=s||!1}function p(l,n,s,o,u){if(typeof s!="function")throw new TypeError("The listener must be a function");var v=new a(s,o||l,u),c=i?i+n:n;return l._events[c]?l._events[c].fn?l._events[c]=[l._events[c],v]:l._events[c].push(v):(l._events[c]=v,l._eventsCount++),l}function m(l,n){--l._eventsCount===0?l._events=new f:delete l._events[n]}function d(){this._events=new f,this._eventsCount=0}d.prototype.eventNames=function(){var n=[],s,o;if(this._eventsCount===0)return n;for(o in s=this._events)e.call(s,o)&&n.push(i?o.slice(1):o);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(s)):n},d.prototype.listeners=function(n){var s=i?i+n:n,o=this._events[s];if(!o)return[];if(o.fn)return[o.fn];for(var u=0,v=o.length,c=new Array(v);u<v;u++)c[u]=o[u].fn;return c},d.prototype.listenerCount=function(n){var s=i?i+n:n,o=this._events[s];return o?o.fn?1:o.length:0},d.prototype.emit=function(n,s,o,u,v,c){var E=i?i+n:n;if(!this._events[E])return!1;var t=this._events[E],y=arguments.length,w,h;if(t.fn){switch(t.once&&this.removeListener(n,t.fn,void 0,!0),y){case 1:return t.fn.call(t.context),!0;case 2:return t.fn.call(t.context,s),!0;case 3:return t.fn.call(t.context,s,o),!0;case 4:return t.fn.call(t.context,s,o,u),!0;case 5:return t.fn.call(t.context,s,o,u,v),!0;case 6:return t.fn.call(t.context,s,o,u,v,c),!0}for(h=1,w=new Array(y-1);h<y;h++)w[h-1]=arguments[h];t.fn.apply(t.context,w)}else{var C=t.length,L;for(h=0;h<C;h++)switch(t[h].once&&this.removeListener(n,t[h].fn,void 0,!0),y){case 1:t[h].fn.call(t[h].context);break;case 2:t[h].fn.call(t[h].context,s);break;case 3:t[h].fn.call(t[h].context,s,o);break;case 4:t[h].fn.call(t[h].context,s,o,u);break;default:if(!w)for(L=1,w=new Array(y-1);L<y;L++)w[L-1]=arguments[L];t[h].fn.apply(t[h].context,w)}}return!0},d.prototype.on=function(n,s,o){return p(this,n,s,o,!1)},d.prototype.once=function(n,s,o){return p(this,n,s,o,!0)},d.prototype.removeListener=function(n,s,o,u){var v=i?i+n:n;if(!this._events[v])return this;if(!s)return m(this,v),this;var c=this._events[v];if(c.fn)c.fn===s&&(!u||c.once)&&(!o||c.context===o)&&m(this,v);else{for(var E=0,t=[],y=c.length;E<y;E++)(c[E].fn!==s||u&&!c[E].once||o&&c[E].context!==o)&&t.push(c[E]);t.length?this._events[v]=t.length===1?t[0]:t:m(this,v)}return this},d.prototype.removeAllListeners=function(n){var s;return n?(s=i?i+n:n,this._events[s]&&m(this,s)):(this._events=new f,this._eventsCount=0),this},d.prototype.off=d.prototype.removeListener,d.prototype.addListener=d.prototype.on,d.prefixed=i,d.EventEmitter=d,g.exports=d})(x);const k=x.exports;class I{constructor(e){r(this,"dropElement");r(this,"events",new k);r(this,"onDragOver",e=>{e.preventDefault(),this.dropElement.classList.add("over")});r(this,"onDragLeave",()=>{this.dropElement.classList.remove("over")});r(this,"onDrop",e=>{var p;e.preventDefault(),this.dropElement.classList.remove("over");const i=(p=e.dataTransfer)==null?void 0:p.items;if(!i||i.length===0)return;const f=Array.from(i).find(m=>m.kind==="file"&&/image/.test(m.type));if(!f)return;const a=f.getAsFile();this.events.emit("onImageFileDrop",{imageFile:a})});this.dropElement=e}init(){return this.dropElement.addEventListener("dragover",this.onDragOver),this.dropElement.addEventListener("dragleave",this.onDragLeave),this.dropElement.addEventListener("drop",this.onDrop),()=>{this.dropElement.removeEventListener("dragover",this.onDragOver),this.dropElement.removeEventListener("dragleave",this.onDragLeave),this.dropElement.removeEventListener("drop",this.onDrop)}}hide(){this.dropElement.classList.remove("active")}show(){this.dropElement.classList.add("active")}}class S{constructor(){r(this,"events",new x.exports.EventEmitter);r(this,"pixelSizeElement",document.getElementById("pixel-size"));r(this,"pixelSizeValueElement",document.getElementById("pixel-size-value"));r(this,"imageRatioElement",document.getElementById("image-ratio"));r(this,"imageRatioValueElement",document.getElementById("image-ratio-value"));r(this,"onPixelSizeChange",()=>{const e=this.pixelSizeElement.value;this.pixelSizeValueElement.textContent=`${e}px`,this.events.emit("onPixelSizeChange",parseInt(e,10))});r(this,"onImageRatioChange",()=>{const e=parseFloat(this.imageRatioElement.value);this.imageRatioValueElement.textContent=`${(e*100).toFixed(0)}%`,this.events.emit("onRatioChange",e)})}init(){return this.pixelSizeElement.addEventListener("change",this.onPixelSizeChange),this.imageRatioElement.addEventListener("change",this.onImageRatioChange),this.pixelSizeElement.dispatchEvent(new Event("change")),this.imageRatioElement.dispatchEvent(new Event("change")),()=>{this.pixelSizeElement.removeEventListener("change",this.onPixelSizeChange),this.imageRatioElement.removeEventListener("change",this.onImageRatioChange)}}}class z{constructor(e){r(this,"worker");r(this,"canvas");r(this,"helper");r(this,"closer");r(this,"download");r(this,"droppable");r(this,"settings");r(this,"image",null);r(this,"pixelSize",4);r(this,"imageRatio",1);r(this,"onMessage",e=>{e.data.type==="processingStart"?this.canvas.classList.add("progress"):e.data.type==="processingEnd"&&(this.canvas.classList.add("active"),this.download.classList.add("active"),this.canvas.classList.remove("progress"))});r(this,"onImageFileDrop",async e=>{this.worker.postMessage({type:"loadImage",file:e.imageFile}),this.closer.classList.add("active"),this.droppable.hide()});r(this,"onPixelSizeChange",e=>{this.pixelSize=e,this.worker.postMessage({type:"setPixelSize",size:e})});r(this,"onImageRatioChange",e=>{this.imageRatio=e,this.worker.postMessage({type:"setImageRatio",ratio:e})});r(this,"onCloserClick",()=>{this.worker.postMessage({type:"clear"}),this.droppable.show(),this.closer.classList.remove("active"),this.download.classList.remove("active"),this.canvas.classList.remove("active")});r(this,"onDownload",()=>{const e=document.createElement("a");e.setAttribute("download","pixelized.png"),e.setAttribute("href",this.canvas.toDataURL()),e.click()});const{worker:i,droppable:f,canvas:a,helper:p,closer:m,download:d}=e;this.worker=i,this.canvas=a,this.helper=p,this.closer=m,this.download=d,this.droppable=new I(f),this.settings=new S}init(){const e=[this.settings.init(),this.droppable.init(),this.settings.init()];this.settings.events.on("onPixelSizeChange",this.onPixelSizeChange),this.settings.events.on("onRatioChange",this.onImageRatioChange),this.droppable.events.on("onImageFileDrop",this.onImageFileDrop);const i=this.canvas.transferControlToOffscreen(),f=this.helper.transferControlToOffscreen();return this.worker.postMessage({type:"initialize",canvas:i,helper:f},[i,f]),this.worker.addEventListener("message",this.onMessage),this.closer.addEventListener("click",this.onCloserClick),this.download.addEventListener("click",this.onDownload),()=>{this.settings.events.off("onPixelSizeChange",this.onPixelSizeChange),this.settings.events.off("onRatioChange",this.onImageRatioChange),this.droppable.events.off("onImageFileDrop",this.onImageFileDrop),this.worker.removeEventListener("message",this.onMessage),this.closer.removeEventListener("click",this.onCloserClick),this.download.removeEventListener("click",this.onDownload);for(const a of e)a()}}}function D(){return new Worker("/assets/worker.12f5bae9.js")}const R=document.getElementById("drop"),O=document.getElementById("app"),P=document.getElementById("helper"),F=document.getElementById("closer"),A=document.getElementById("download"),B=new D,M=new z({worker:B,helper:P,canvas:O,closer:F,droppable:R,download:A});M.init();
